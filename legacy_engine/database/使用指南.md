# ğŸ¯ NeoFeed æ•°æ®åº“ä½¿ç”¨æŒ‡å—

## âœ… å·²ç”Ÿæˆçš„æ–‡ä»¶

```
database/
â”œâ”€â”€ schema.sql                # SQLite æ•°æ®åº“ç»“æ„å®šä¹‰
â”œâ”€â”€ init_db.py               # æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
â”œâ”€â”€ test_data.py             # æµ‹è¯•æ•°æ®ç”Ÿæˆè„šæœ¬
â”œâ”€â”€ test_queries.py          # æŸ¥è¯¢æµ‹è¯•è„šæœ¬
â”œâ”€â”€ migrate_to_postgres.py   # PostgreSQL è¿ç§»å·¥å…·
â”œâ”€â”€ quick_start.sh           # ä¸€é”®å¯åŠ¨è„šæœ¬
â”œâ”€â”€ README.md                # è¯¦ç»†æ–‡æ¡£
â””â”€â”€ ä½¿ç”¨æŒ‡å—.md              # æœ¬æ–‡ä»¶
```

---

## ğŸš€ ä¸‰ç§å¯åŠ¨æ–¹å¼

### æ–¹å¼ 1ï¼šä¸€é”®å¯åŠ¨ï¼ˆæ¨èï¼‰â­

```bash
cd database
./quick_start.sh
```

è¿™ä¼šè‡ªåŠ¨å®Œæˆï¼š
- âœ… åˆå§‹åŒ–æ•°æ®åº“
- âœ… æ’å…¥æµ‹è¯•æ•°æ®
- âœ… è¿è¡ŒæŸ¥è¯¢æµ‹è¯•

### æ–¹å¼ 2ï¼šåˆ†æ­¥æ‰§è¡Œ

```bash
# æ­¥éª¤ 1ï¼šåˆå§‹åŒ–æ•°æ®åº“
python3 init_db.py

# æ­¥éª¤ 2ï¼šæ’å…¥æµ‹è¯•æ•°æ®
python3 test_data.py

# æ­¥éª¤ 3ï¼šæµ‹è¯•æŸ¥è¯¢
python3 test_queries.py
```

### æ–¹å¼ 3ï¼šåªåˆ›å»ºç©ºæ•°æ®åº“

```bash
python3 init_db.py
# ç„¶ååœ¨ä½ çš„åº”ç”¨ä¸­æ’å…¥çœŸå®æ•°æ®
```

---

## ğŸ“Š ç”Ÿæˆçš„æµ‹è¯•æ•°æ®

è¿è¡Œ `test_data.py` åä¼šè‡ªåŠ¨åˆ›å»ºï¼š

### ğŸ‘¤ ç”¨æˆ·
- Email: test@neofeed.com
- Telegram ID: 123456789

### ğŸ“š ä¿¡æ¯æ¡ç›®ï¼ˆ5æ¡ï¼‰
1. äº§å“æ€è€ƒï¼šå¦‚ä½•åšå¥½ç”¨æˆ·å¢é•¿
2. AI èµ‹èƒ½ä¸ªäººç”Ÿäº§åŠ›çš„äº”ä¸ªåœºæ™¯
3. ä»Šå¤©å’Œ GPT è®¨è®ºäº†äº§å“è®¾è®¡
4. å…³äºçŸ¥è¯†ç®¡ç†çš„æ€è€ƒ
5. ä¸ºä»€ä¹ˆå¤§éƒ¨åˆ†ç¬”è®°å·¥å…·éƒ½å¤±è´¥äº†

### ğŸ¤– AI å¤„ç†ç»“æœ
- æ¯æ¡ä¿¡æ¯éƒ½æœ‰ï¼šæ‘˜è¦ã€åˆ†ç±»ã€å…³é”®è¯ã€é‡è¦æ€§è¯„åˆ†

### ğŸ·ï¸ æ ‡ç­¾
- AIã€äº§å“ã€å¢é•¿ã€è®¾è®¡ã€å·¥å…·ã€é‡è¦

### ğŸ“… å‘¨æŠ¥
- å®Œæ•´çš„ä¸€å‘¨çŸ¥è¯†å‘¨æŠ¥ï¼ˆMarkdown æ ¼å¼ï¼‰
- åŒ…å«èšç±»åˆ†æã€ç»Ÿè®¡æ•°æ®ã€æ ¸å¿ƒæ´å¯Ÿ

---

## ğŸ” æŸ¥çœ‹æ•°æ®åº“

### æ–¹æ³• 1ï¼šä½¿ç”¨ DB Browser for SQLiteï¼ˆæ¨èï¼‰

1. ä¸‹è½½å®‰è£…ï¼šhttps://sqlitebrowser.org/
2. æ‰“å¼€ `neofeed.db`
3. å¯è§†åŒ–æµè§ˆæ‰€æœ‰æ•°æ®

### æ–¹æ³• 2ï¼šå‘½ä»¤è¡Œ

```bash
# è¿›å…¥ SQLite äº¤äº’æ¨¡å¼
sqlite3 neofeed.db

# æŸ¥çœ‹æ‰€æœ‰è¡¨
.tables

# æŸ¥çœ‹ç”¨æˆ·
SELECT * FROM users;

# æŸ¥çœ‹ä¿¡æ¯æ¡ç›®
SELECT title, source_type, status FROM items;

# æŸ¥çœ‹ AI å¤„ç†ç»“æœ
SELECT i.title, a.category, a.importance_score 
FROM items i 
JOIN ai_results a ON a.item_id = i.id;

# é€€å‡º
.quit
```

### æ–¹æ³• 3ï¼šPython ä»£ç 

```python
import sqlite3
import json

conn = sqlite3.connect('neofeed.db')
cursor = conn.cursor()

# æŸ¥è¯¢æ‰€æœ‰ä¿¡æ¯ï¼ˆå¸¦AIç»“æœï¼‰
cursor.execute("""
    SELECT 
        i.title,
        a.summary,
        a.category,
        a.keywords
    FROM items i
    LEFT JOIN ai_results a ON a.item_id = i.id
""")

for row in cursor.fetchall():
    print(f"æ ‡é¢˜: {row[0]}")
    print(f"æ‘˜è¦: {row[1]}")
    print(f"åˆ†ç±»: {row[2]}")
    print(f"å…³é”®è¯: {row[3]}")
    print("-" * 60)

conn.close()
```

---

## ğŸ”„ è¿ç§»åˆ°ç”Ÿäº§ç¯å¢ƒ

å½“æœ¬åœ°æµ‹è¯•å®Œæˆåï¼Œè¿ç§»åˆ° Supabase/PostgreSQLï¼š

### æ­¥éª¤ 1ï¼šå‡†å¤‡ Supabase é¡¹ç›®

1. è®¿é—® https://supabase.com
2. åˆ›å»ºæ–°é¡¹ç›®
3. è·å–è¿æ¥ä¿¡æ¯ï¼ˆDatabase Settings â†’ Connection Stringï¼‰

### æ­¥éª¤ 2ï¼šè¿è¡Œè¿ç§»è„šæœ¬

```bash
python3 migrate_to_postgres.py
```

æŒ‰æç¤ºè¾“å…¥ï¼š
- ä¸»æœºï¼šdb.xxxxx.supabase.co
- ç«¯å£ï¼š5432
- æ•°æ®åº“åï¼špostgres
- ç”¨æˆ·åï¼špostgres
- å¯†ç ï¼šä½ çš„æ•°æ®åº“å¯†ç 

### æ­¥éª¤ 3ï¼šéªŒè¯

åœ¨ Supabase Dashboard çš„ SQL Editor ä¸­ï¼š

```sql
-- æ£€æŸ¥è¡¨
SELECT table_name 
FROM information_schema.tables 
WHERE table_schema = 'public';

-- æ£€æŸ¥æ•°æ®
SELECT COUNT(*) FROM items;
```

---

## ğŸ’¡ å®é™…ä½¿ç”¨ç¤ºä¾‹

### åœºæ™¯ 1ï¼šåœ¨ Python åº”ç”¨ä¸­ä½¿ç”¨

```python
import sqlite3

class NeoFeedDB:
    def __init__(self, db_path='neofeed.db'):
        self.conn = sqlite3.connect(db_path)
        self.conn.row_factory = sqlite3.Row
        self.cursor = self.conn.cursor()
    
    def add_item(self, user_id, title, content, source_type):
        """æ·»åŠ æ–°ä¿¡æ¯"""
        self.cursor.execute("""
            INSERT INTO items (user_id, title, content, source_type, status)
            VALUES (?, ?, ?, ?, 'pending')
        """, (user_id, title, content, source_type))
        self.conn.commit()
        return self.cursor.lastrowid
    
    def get_pending_items(self, user_id):
        """è·å–å¾…å¤„ç†çš„ä¿¡æ¯"""
        self.cursor.execute("""
            SELECT * FROM items 
            WHERE user_id = ? AND status = 'pending'
            ORDER BY created_at DESC
        """, (user_id,))
        return self.cursor.fetchall()
    
    def save_ai_result(self, item_id, user_id, summary, category, keywords):
        """ä¿å­˜ AI å¤„ç†ç»“æœ"""
        self.cursor.execute("""
            INSERT INTO ai_results 
            (item_id, user_id, summary, category, keywords)
            VALUES (?, ?, ?, ?, ?)
        """, (item_id, user_id, summary, category, keywords))
        
        # æ›´æ–°æ¡ç›®çŠ¶æ€
        self.cursor.execute("""
            UPDATE items SET status = 'processed' WHERE id = ?
        """, (item_id,))
        
        self.conn.commit()
    
    def close(self):
        self.conn.close()

# ä½¿ç”¨ç¤ºä¾‹
db = NeoFeedDB()
item_id = db.add_item(1, "æµ‹è¯•æ ‡é¢˜", "æµ‹è¯•å†…å®¹", "manual")
db.save_ai_result(item_id, 1, "è¿™æ˜¯æ‘˜è¦", "æµ‹è¯•åˆ†ç±»", "å…³é”®è¯1,å…³é”®è¯2")
db.close()
```

### åœºæ™¯ 2ï¼šé›†æˆ Telegram Bot

```python
from telegram import Update
from telegram.ext import Application, MessageHandler, filters

db = NeoFeedDB()

async def handle_message(update: Update, context):
    """å¤„ç†ç”¨æˆ·å‘é€çš„æ¶ˆæ¯"""
    user = update.effective_user
    text = update.message.text
    
    # ä¿å­˜åˆ°æ•°æ®åº“
    item_id = db.add_item(
        user_id=1,  # å®é™…åº”è¯¥ä» telegram_id æŸ¥è¯¢
        title=text[:50],  # å–å‰50å­—ä½œä¸ºæ ‡é¢˜
        content=text,
        source_type='telegram'
    )
    
    await update.message.reply_text(f"âœ… å·²ä¿å­˜ï¼ID: {item_id}")
    
    # è¿™é‡Œå¯ä»¥è§¦å‘ AI å¤„ç†ä»»åŠ¡
    # process_with_ai(item_id)

# å¯åŠ¨ bot
app = Application.builder().token("YOUR_BOT_TOKEN").build()
app.add_handler(MessageHandler(filters.TEXT, handle_message))
app.run_polling()
```

---

## ğŸ› å¸¸è§é—®é¢˜

### Q1: è¿è¡Œè„šæœ¬æŠ¥é”™ "No module named 'sqlite3'"

**A:** Python è‡ªå¸¦ sqlite3ï¼Œä¸éœ€è¦å®‰è£…ã€‚å¦‚æœæŠ¥é”™ï¼š
```bash
# æ£€æŸ¥ Python ç‰ˆæœ¬
python3 --version

# ç¡®ä¿ä½¿ç”¨ Python 3.6+
```

### Q2: æ•°æ®åº“è¢«é”å®š

**A:** ç¡®ä¿æ²¡æœ‰å…¶ä»–ç¨‹åºæ­£åœ¨è®¿é—®æ•°æ®åº“ï¼š
```bash
# å…³é—­æ‰€æœ‰ Python è¿›ç¨‹
pkill python3

# æˆ–è€…åˆ é™¤æ•°æ®åº“é‡æ–°åˆ›å»º
rm neofeed.db
python3 init_db.py
```

### Q3: å¦‚ä½•é‡ç½®æ•°æ®åº“ï¼Ÿ

**A:** 
```bash
# åˆ é™¤æ•°æ®åº“æ–‡ä»¶
rm neofeed.db

# é‡æ–°åˆå§‹åŒ–
./quick_start.sh
```

### Q4: è¿ç§»åˆ° PostgreSQL å ID ä¸å¯¹åº”ï¼Ÿ

**A:** è¿ç§»è„šæœ¬ä¼šè‡ªåŠ¨å¤„ç† ID æ˜ å°„ã€‚å¦‚æœå‡ºé—®é¢˜ï¼š
- PostgreSQL ä½¿ç”¨ UUIDï¼Œä¸è¦ä¾èµ–æ•°å­— ID
- é€šè¿‡å…¶ä»–å­—æ®µï¼ˆå¦‚ emailã€urlï¼‰å…³è”æ•°æ®

---

## ğŸ“š ä¸‹ä¸€æ­¥

1. âœ… **éªŒè¯æ•°æ®åº“**ï¼šè¿è¡Œ `test_queries.py` ç¡®ä¿ä¸€åˆ‡æ­£å¸¸
2. âœ… **é›†æˆåˆ°åº”ç”¨**ï¼šåœ¨ä½ çš„ Python ä»£ç ä¸­è¿æ¥æ•°æ®åº“
3. âœ… **å¼€å‘ AI å¤„ç†**ï¼šç¼–å†™ä»£ç è°ƒç”¨ OpenAI API
4. âœ… **ç”Ÿæˆå‘¨æŠ¥**ï¼šå®ç°èšç±»å’ŒæŠ¥å‘Šç”Ÿæˆé€»è¾‘
5. âœ… **è¿ç§»åˆ°äº‘ç«¯**ï¼šå‡†å¤‡å¥½åè¿ç§»åˆ° Supabase

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

- æŸ¥çœ‹ `README.md` è·å–è¯¦ç»†æ–‡æ¡£
- è¿è¡Œ `test_queries.py` æŸ¥çœ‹å„ç§æŸ¥è¯¢ç¤ºä¾‹
- æ£€æŸ¥ç”Ÿæˆçš„ä»£ç ä¸­çš„æ³¨é‡Š

---

*ç¥ä½ å¼€å‘é¡ºåˆ©ï¼ğŸš€*

