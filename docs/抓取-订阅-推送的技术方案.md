# NeoFeed 智能情报系统：抓取-订阅-推送全链路技术方案

## 0. 概述 (Executive Summary)
NeoFeed 的核心价值在于将“无限的信息洪流”转化为“有限的、高质量的情报”。本方案构建了一套 **“自动巡逻 -> 价值过滤 -> 结构化加工 -> 情感化交付”** 的全链路闭环，旨在为用户提供高度定制化的数字情报订阅体验。

---

## 1. 信号采集层 (Signal Crawling Layer)
系统如何从复杂的互联网环境中提取原始数据？

### 1.1 RSS 轮询引擎 (RSS Poller)
*   **技术实现**：基于 `rss-parser` 库，支持所有标准的 RSS 2.0, Atom 和 JSON Feed 协议。
*   **并发控制**：由 Inngest 调度器触发，针对不同域名的源采用排队机制，防止被源站封禁 IP。

### 1.2 内容降噪与清洗 (Jina Reader Integration)
*   **核心逻辑**：原始网页存在大量广告、脚本和导航干扰。系统通过 **Jina Reader API** 作为网关，将任意 URL 实时转化为纯净、标准的 Markdown 格式。
*   **优势**：大幅降低 AI 读取的 Token 消耗，并消除反爬虫限制（尤其是针对微信公众号、Medium 等封闭平台）。

### 1.3 视频多模态抓取 (Video-Aware Ingestion)
*   **自动识别**：系统识别到 Youtube 或 Bilibili 链接时，会自动切换至“视频转录模式”。
*   **转录稿优先**：通过特定的 DOM 选择器优先抓取视频的 **字幕 (Transcript)** 和描述信息，使 AI 能够“阅读”视频。

---

## 2. 神经加工层 (Intelligence Processing Layer)
系统如何定义“什么值得读”？

### 2.1 智能漏斗 (AI Filter)
*   **处理流程**：当一个订阅源有 100 条更新时，系统不会全部存储。AI 会首先审阅这 100 条标题和摘要。
*   **挑选准则**：基于用户配置的提示词，从 **洞察力、时效性、质量、领域相关度** 四个维度进行 0-1 评分，仅保留 Top 7 的精选情报入库。

### 2.2 深度分析与建模 (Content Summarization)
*   **结构化输出**：使用 `DeepSeek-V3` 模型并开启 **JSON Mode**，确保输出字段的严格标准：
    *   `summary`: 300 字深度摘要。
    *   `takeaways`: 3 条可落地的关键洞察。
    *   `category`: 自动归类 (TECH, LIFE, IDEA, ART, OTHER)。
    *   `reading_time`: 精准的预估阅读时长。

---

## 3. 自动化调度层 (Orchestration Layer)
系统如何保证自动化任务的高可靠性？

### 3.1 异步任务编排 (Inngest Serverless Queue)
*   **事件驱动**：每一个 RSS 同步或周报生成都是一个独立的 `Event`。
*   **重试机制**：如果 AI API 暂时连接超时，Inngest 会自动进行指数级退避重试（Exponential Backoff），确保情报永不丢失。

### 3.2 自定义触发逻辑 (Customizable Cron)
*   **精准调度**：巡逻员每 30 分钟唤醒一次，对比当前服务器时间与用户在 UI 上设置的配置：
    *   `Daily`: 北京时间 09:00 AM 触发。
    *   `Weekly`: 每周一 09:00 AM 触发。
*   **资源节约**：仅在命中用户设定频率的时间窗口内才产生 API 调用，极大优化了成本。

---

## 4. 交付与推送层 (Delivery Layer)
情报如何最终抵达用户？

### 4.1 双轨周报系统 (Weekly Protocol)
*   **任务解耦**：系统区分 **“洞察周报 (Insight)”**（手动收集）与 **“订阅周报 (RSS)”**（自动同步）。
*   **独立提示词 (Prompts)**：PM 可针对不同类型的周报预设不同的 AI 角色和风格。

### 4.2 情感化邮件引擎 (Styled Email Engine)
*   **技术链路**：基于 `Brevo (Sendinblue)` 交易邮件 API。
*   **视觉规范**：
    *   采用 **Fallout (辐射) 废土风格** HTML 模板。
    *   使用高对比度绿色 (#1ff40a) 与深色背景。
    *   响应式布局，完美适配手机端、桌面端和 Apple Watch 的阅读体验。

---

## 5. 性能与限额影响 (Performance & Limits)
*   **存储压力**：`discovery_stream` 表每周日凌晨自动清空，保持数据库轻量化。
*   **处理效率**：单条 RSS 同步（抓取+过滤+总结）平均耗时约 8-12 秒。
*   **额度安全**：单用户月均消耗约 10,000 条数据库行数，完全在主流云服务免费额度内。

---
**NeoFeed 技术团队 // 2026-01-15**
