# NeoFeed 智能情报系统：抓取-订阅-推送全链路技术方案

## 0. 概述 (Executive Summary)
NeoFeed 的核心价值在于将“无限的信息洪流”转化为“有限的、高质量的情报”。本方案构建了一套 **“自动巡逻 -> 价值过滤 -> 结构化加工 -> 情感化交付”** 的全链路闭环，旨在为用户提供高度定制化的数字情报订阅体验。

---

## 1. 信号采集层 (Signal Crawling Layer)
系统如何从复杂的互联网环境中提取原始数据？

### 1.1 RSS 轮询引擎 (RSS Poller)
*   **技术实现**：基于 `rss-parser` 库，支持所有标准的 RSS 2.0, Atom 和 JSON Feed 协议。
*   **并发控制**：由 Inngest 调度器触发，针对不同域名的源采用排队机制，防止被源站封禁 IP。

### 1.2 内容降噪与清洗 (Jina Reader Integration)
*   **核心逻辑**：原始网页存在大量广告、脚本和导航干扰。系统通过 **Jina Reader API** 作为网关，将任意 URL 实时转化为纯净、标准的 Markdown 格式。
*   **优势**：大幅降低 AI 读取的 Token 消耗，并消除反爬虫限制（尤其是针对微信公众号、Medium 等封闭平台）。

### 1.3 视频多模态抓取 (Video-Aware Ingestion)
*   **自动识别**：系统识别到 Youtube 或 Bilibili 链接时，会自动切换至“视频转录模式”。
*   **转录稿优先**：通过特定的 DOM 选择器优先抓取视频的 **字幕 (Transcript)** 和描述信息，使 AI 能够“阅读”视频。

---

## 2. 神经加工层 (Intelligence Processing Layer)
系统如何定义“什么值得读”？

### 2.1 全量情报拦截 (Full-Spectrum Ingestion)
*   **处理流程**：取消之前的 Top 7 筛选机制，系统现在全量接收 RSS 更新内容（单次同步上限 20 条），确保不遗漏任何潜在信号。
*   **同步即清空 (Sync & Clear)**：为了保持情报的极高时效性，每次同步（无论是自动还是手动触发）都会先清空该来源在数据库中的旧数据，确保用户看到的永远是“此时此刻”的最新鲜情报。

### 2.2 结构化科研总结 (Structured Research Analysis)
*   **深度建模**：针对科研论文、技术深度文章，AI 强制执行 **“四段式总结协议”**：
    1.  **研究主题**：核心关注点。
    2.  **研究方式**：技术路径或实验手段。
    3.  **研究结果**：产出的数据或结论。
    4.  **闭环总结**：一句话描述“谁做了什么，解决了什么”。
*   **动态关键词标签 (Keyword Tags)**：从内容中动态提取 3-5 个高精度关键词标签，取代传统的死板分类。

---

## 3. 自动化调度层 (Orchestration Layer)
系统如何保证自动化任务的高可靠性？

### 3.1 异步任务编排 (Inngest Serverless Queue)
*   **事件驱动**：每一个 RSS 同步或周报生成都是一个独立的 `Event`。
*   **重试机制**：如果 AI API 暂时连接超时，Inngest 会自动进行指数级退避重试（Exponential Backoff），确保情报永不丢失。

### 3.2 自定义触发逻辑 (Customizable Cron)
*   **频率对齐**：同步频率支持“每天 (9:00 AM)”或“每周一 (9:00 AM)”。周报生成逻辑与此频率完美契合，确保周报内容即为当前库内的全量拦截成果。

---

## 4. 交付与推送层 (Delivery Layer)
情报如何最终抵达用户？

### 4.1 双轨周报系统 (Weekly Protocol)
*   **任务解耦**：系统区分 **“洞察周报 (Insight)”**（手动收集）与 **“订阅周报 (RSS)”**（自动同步）。
*   **独立提示词 (Prompts)**：PM 可针对不同类型的周报预设不同的 AI 角色和风格。

### 4.2 情感化邮件引擎 (Styled Email Engine)
*   **技术链路**：基于 `Brevo (Sendinblue)` 交易邮件 API。
*   **视觉规范**：
    *   采用 **Fallout (辐射) 废土风格** HTML 模板。
    *   使用高对比度绿色 (#1ff40a) 与深色背景。
    *   响应式布局，完美适配手机端、桌面端和 Apple Watch 的阅读体验。

---

## 5. 性能与限额影响 (Performance & Limits)
*   **存储压力**：`discovery_stream` 表每周日凌晨自动清空，保持数据库轻量化。
*   **处理效率**：单条 RSS 同步（抓取+过滤+总结）平均耗时约 8-12 秒。
*   **额度安全**：单用户月均消耗约 10,000 条数据库行数，完全在主流云服务免费额度内。

---
**NeoFeed 技术团队 // 2026-01-15**
